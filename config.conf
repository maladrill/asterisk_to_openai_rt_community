# =========================================
# Voice Agent (Asterisk + OpenAI Realtime) — Configuration
# NOTE: Replace ALL <PLACEHOLDER> values before production. Keep this file private (e.g., chmod 600).
# =========================================

# OpenAI API key for Realtime/TTS/Whisper.
# Example: sk-proj-********************************
OPENAI_API_KEY=<YOUR_OPENAI_API_KEY>

# Asterisk REST Interface (ARI) base URL.
# Use HTTPS if exposed beyond localhost.
ARI_URL=http://127.0.0.1:8088

# ARI username (must match ari.conf).
ARI_USERNAME=openai_rt

# ARI password (must match ari.conf). Keep secret.
ARI_PASSWORD=<YOUR_ARI_PASSWORD_HERE>

# Maximum number of simultaneous calls handled by the agent.
# Tune based on CPU/RAM/network capacity.
MAX_CONCURRENT_CALLS=10

# Logging verbosity: error | warn | info | debug | trace
# Use 'info' in prod; switch to 'debug' when troubleshooting.
LOG_LEVEL=info

# System instruction for the model (scope, language policy, escalation).
# Keep concise but complete. Externalize to a file if it grows.
SYSTEM_PROMPT="You are an assistant for a nationwide telecommunications provider — SQS Polska. Handle outage reports only. Greet and introduce yourself as a Technical Support Assistant. Speak in English only; if the caller responds in another language, ask them to repeat in English — never reply in any language other than English. Ask whether you can help with reporting an outage. Your task is to collect as many of the following details as possible. Always ask questions one at a time: 1) Caller’s full name and the company name if this is a business service; 2) The type of service affected (internet, data transmission, dark fiber lease, phone, PBX); 3) Service ID as shown on the invoice (optional); 4) Address where the outage occurs; 5) Description of the issue. Ask whether the technical team should call back the number being used now, or if the caller wants to provide a different contact number. Ask to fill in any missing information unless marked as optional. When you have all the details, summarize the findings. Start the sentence with: 'Summarizing the ticket for the technical department:'. Ask if the caller wants to add anything. If not, thank them. Finish with: 'Goodbye.' Never answer the caller’s general questions — your job is to obtain outage information. To questions you must respond: 'I’m sorry, but I’m a technical support assistant handling outage reports and I don’t know the answer to your question.' Only if you are asked to connect to a human, consultant, or staff member, you may respond with exactly: 'Okay, connecting you to the technical department' or 'Thank you, connecting you to a representative', after which the call will be redirected. If the caller insults you, say: 'I’m sorry that we’re having trouble communicating. Could I ask you not to use such words?' and then return to handling the outage report."

# First phrase spoken to Assistant.
INITIAL_MESSAGE="Hello"

# OpenAI Realtime model used for duplex audio. Verify availability.
REALTIME_MODEL=gpt-4o-realtime-preview-2025-06-03

# Extra silence appended after TTS playback (ms). Typical: 50–200.
SILENCE_PADDING_MS=100
# VAD sensitivity (0.0–1.0). Higher = less sensitive.
VAD_THRESHOLD=0.6

# Pre-speech audio kept to avoid clipping word onsets (ms).
VAD_PREFIX_PADDING_MS=200

# Silence length (ms) that marks end of caller’s turn.
VAD_SILENCE_DURATION_MS=600

# Hard cap on call duration (seconds). Agent should close gracefully.
CALL_DURATION_LIMIT_SECONDS=300

# --- Speech & Transcription ---------------------------------------------------
# Global settings for TTS (text-to-speech) and ASR (automatic speech recognition)

# Available TTS voices: 'alloy','ash','ballad','coral','echo','sage','shimmer','verse','marin','cedar'
# Pick a voice that is clear and neutral for support.
OPENAI_VOICE=ash

# ASR model (Whisper). Ensure your integration supports streaming if needed.
TRANSCRIPTION_MODEL=whisper-1

# ASR language code (forcing language improves accuracy vs auto-detect).
TRANSCRIPTION_LANGUAGE=pl

# Directory for audio and/or transcripts.
# Ensure 'asterisk' user has RW permissions. Plan retention (GDPR).
RECORDINGS_DIR=/var/spool/asterisk/monitor 

# --- Redirection & Termination ------------------------------------------------

# Comma-separated, quoted phrases that trigger transfer to the queue.
# Matching is implementation-specific (exact/partial/case-insensitive).
REDIRECTION_PHRASES="'Dobrze, łączę z działem technicznym','Dziękuję, łączę z pracownikiem.'"

# Comma-separated, quoted phrases which, if spoken by the agent, end the call.
AGENT_TERMINATE_PHRASES="'do widzenia','żegnam'"

# Destination Queue (FreePBX app number). Must exist in the dialplan.
REDIRECTION_QUEUE=3000

# --- Email on natural call end (not after redirect/handoff) -------------------

# Enable sending an email with the transcript after a normal call end.
EMAIL_ENABLED=true

# SMTP server hostname (outbound mail relay)
SMTP_HOST=mail.example.com

# SMTP port (465 = implicit TLS / SMTPS).
SMTP_PORT=465
# true = SSL/TLS (implicit). For STARTTLS on 587, set false and enable STARTTLS in your mailer.
SMTP_SECURE=true

# SMTP auth username (mailbox). Use a dedicated mailbox if possible.
SMTP_USER=<YOUR_SMTP_USER_EMAIL_HERE>

# SMTP auth password. Store securely (env var or secret manager preferred).
SMTP_PASS=<YOUR_SMTP_PASSWORD_HERE>

# Friendly From header. Use a valid sender at your domain.
# Keep quotes if the display name contains spaces.
EMAIL_FROM="Asystent SQS Polska <no-reply@your-domain.tld>"

# Comma-separated recipient list for notifications.
# Example: ops@sqspolska.pl, noc@sqspolska.pl
EMAIL_TO=<PRIMARY_RECIPIENT_EMAIL_HERE>, <SECONDARY_RECIPIENT_EMAIL_HERE>

# Subject template with tokens ({{callerId}}, {{channelId}}, {{reason}}).
EMAIL_SUBJECT_TEMPLATE=SQS — Conversation transcript {{callerId}} ({{channelId}})

# Plain-text body template. \n produces new lines; tokens replaced at send time.
EMAIL_BODY_TEMPLATE=Attached is the conversation transcript.\nCaller: {{callerId}}\nChannel: {{channelId}}\nReason: {{reason}}\n


